# Story 1.5.7: Chapter Grid Component (Revised)

## Status
**Approved** - Ready for Development

## Story
**As a** user,  
**I want** to see an overview of all 8 chapters with my progress visualization,  
**so that** I can choose which chapter to study next.

## Acceptance Criteria
1. ChapterGrid component renders a grid of all 8 chapters (component-only; route already created in Story 1.5.3.5).
2. Each chapter card shows:
   - Chapter number and title
   - Progress bar (e.g., "12/42 completed")
   - Free/Premium badge (Chip component)
   - Chapter thumbnail or icon (optional)
3. Clicking a free chapter navigates to the first concept in that chapter.
4. For free users, premium chapters (5-8) show a lock indicator and trigger an upgrade prompt instead of navigating.
5. Responsive layout:
   - Desktop (≥960px): 3 columns
   - Tablet (768-959px): 2 columns
   - Mobile (<768px): 1 column
6. Built using MUI components (Grid, Card, LinearProgress, Chip, Typography).
7. Accessible and meets WCAG 2.1 AA standards.
8. `/chapters/page.tsx` uses ChapterGrid component to replace the placeholder text added in 1.5.3.5.

## Tasks / Subtasks

- [ ] Create ChapterGrid Component (AC: 1, 5, 6)
  - [ ] Create `apps/web/src/components/Chapters/ChapterGrid.tsx`
  - [ ] Use MUI Grid for responsive layout (3/2/1 columns)
  - [ ] Define strict TypeScript interfaces for data
  - [ ] Render 8 chapter cards from API data

- [ ] Build ChapterCard Component (AC: 2, 6)
  - [ ] Create `apps/web/src/components/Chapters/ChapterCard.tsx`
  - [ ] Display chapter number, title, optional thumbnail/icon
  - [ ] Add Free/Premium badge (Chip)
  - [ ] Style per brand guidelines

- [ ] Add Progress Visualization (AC: 2)
  - [ ] MUI LinearProgress + progress text ("X/Y concepts completed")
  - [ ] Animate on load (250ms)

- [ ] Implement Navigation & Gating (AC: 3, 4)
  - [ ] Click free chapter → navigate to first concept
  - [ ] Click premium chapter (free user) → show upgrade prompt
  - [ ] Premium users can access all chapters

- [ ] Integrate on `/chapters` Page (AC: 8)
  - [ ] Update `apps/web/src/app/chapters/page.tsx` to render ChapterGrid instead of placeholder
  - [ ] Pass current user info (premium status) if needed

- [ ] Fetch Chapter Data (AC: 1, 2)
  - [ ] Call `GET /api/chapters`
  - [ ] Skeleton loading state and error state
  - [ ] Map API response to component props

- [ ] Accessibility (AC: 7)
  - [ ] ARIA labels for cards and buttons
  - [ ] Keyboard navigation and focus indicators
  - [ ] Screen reader announcements for progress and premium status

- [ ] Tests (Unit/Integration) (AC: 1-7)
  - [ ] Grid renders 8 chapter cards
  - [ ] Responsive columns at breakpoints
  - [ ] Progress bars and text are accurate
  - [ ] Navigation works for free chapters
  - [ ] Premium gating shows lock and upgrade prompt for free users

## Dev Notes

### Dependencies
- ✅ Story 1.5.3.5: Page Integration & Route Migration — `/chapters` route exists and is wrapped with MainLayout
- ✅ Story 1.6 Backend: `GET /api/chapters` endpoint — Complete

### Source Tree Information
**New Components:**
```
apps/web/src/components/Chapters/ChapterGrid.tsx
apps/web/src/components/Chapters/ChapterCard.tsx
```

**File to Update:**
```
apps/web/src/app/chapters/page.tsx        # Replace placeholder with ChapterGrid
```

### Technology Stack
- Next.js 15.5.x App Router (Server Components by default)
- MUI (Material-UI) ~5.x
- TypeScript ~5.x with strict mode

### Example Structures
```typescript
// apps/web/src/components/Chapters/ChapterGrid.tsx
interface ChapterGridProps {
  userId?: string;
}

export function ChapterGrid({ userId }: ChapterGridProps) {
  // Fetch chapters
  // Render grid of ChapterCard components
}
```

```typescript
// apps/web/src/components/Chapters/ChapterCard.tsx
interface ChapterCardProps {
  chapter: {
    id: string;
    chapter_number: number;
    title: string;
    is_premium: boolean;
    concept_count: number;
    completed_concept_count: number;
    first_concept_slug: string;
  };
  isPremiumUser: boolean;
  onUpgradeClick?: () => void;
}

export function ChapterCard({ chapter, isPremiumUser, onUpgradeClick }: ChapterCardProps) {
  // Render individual chapter card
}
```

```typescript
// apps/web/src/app/chapters/page.tsx (updated)
import { MainLayout } from '@/components/Layout/MainLayout';
import { ChapterGrid } from '@/components/Chapters/ChapterGrid';
import { requireAuth } from '@/lib/auth-utils';

export default async function ChaptersPage() {
  const session = await requireAuth();
  
  return (
    <MainLayout user={session.user}>
      <ChapterGrid userId={session.user.id} />
    </MainLayout>
  );
}
```

### API Contract
```typescript
// GET /api/chapters
// Returns:
{
  chapters: Array<{
    id: string;
    chapter_number: number;
    title: string;
    is_premium: boolean;
    concept_count: number;
    completed_concept_count: number;
    first_concept_slug: string;
  }>;
}
```

### Premium Gating Logic
```typescript
const isPremiumLocked = chapter.is_premium && !isPremiumUser;

<Card 
  onClick={() => isPremiumLocked ? onUpgradeClick?.() : navigateToChapter(chapter)}
  sx={{ cursor: isPremiumLocked ? 'not-allowed' : 'pointer', opacity: isPremiumLocked ? 0.7 : 1 }}
>
  {isPremiumLocked && (
    <Box sx={{ position: 'absolute', top: 16, right: 16 }}>
      <LockIcon color="warning" />
    </Box>
  )}
  {/* Card content */}
</Card>
```

## Testing

**Unit Tests:**
- `apps/web/__tests__/components/Chapters/ChapterGrid.test.tsx`
- `apps/web/__tests__/components/Chapters/ChapterCard.test.tsx`
- `apps/web/__tests__/app/chapters/page.test.tsx`

**Required Scenarios:**
1. Grid renders 8 chapter cards
2. Responsive layout (3/2/1 columns)
3. Progress bars show correct percentage and text
4. Navigation to first concept for free chapters
5. Premium gating for free users shows lock and upgrade prompt
6. Accessibility (ARIA, keyboard, focus)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-02 | 1.0 | Initial story creation for Epic 1.5 | Bob (Scrum Master) |
| 2025-10-04 | 1.1 | Revised per SCP-2025-002: focus on component only, integrate into existing /chapters route | Bob (SM) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

### Agent Model Used
*Will be recorded by dev agent*

### Debug Log References
*Will be populated by the development agent*

### Completion Notes List
*Will be populated by the development agent*

### File List
*Will be populated by the development agent*

## QA Results
*This section will be populated by QA Agent after implementation*
