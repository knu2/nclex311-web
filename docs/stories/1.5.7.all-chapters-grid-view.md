# Story 1.5.7: All Chapters Grid View

## Status
**Draft**

## Story
**As a** user,  
**I want** to see an overview of all chapters with my progress,  
**so that** I can choose which chapter to study next.

## Acceptance Criteria
1. A dedicated route `/chapters` displays a grid of all 8 chapters.
2. Each chapter card shows:
   - Chapter number and title
   - Progress bar (e.g., "12/42 completed")
   - Free/Premium badge
   - Thumbnail or icon
3. Clicking a chapter navigates to the first concept in that chapter.
4. Free users see a lock icon on premium chapters (5-8).
5. Clicking a premium chapter (for free users) shows upgrade prompt.
6. The grid is responsive:
   - Desktop: 2-3 columns
   - Tablet: 2 columns
   - Mobile: 1 column
7. Chapter cards use MUI components (Card, CardContent, LinearProgress).
8. The view is accessible and meets WCAG 2.1 AA standards.

## Tasks / Subtasks

- [ ] Task 1: Create Chapter Grid Page (AC: 1)
  - [ ] Create `src/app/chapters/page.tsx` page file
  - [ ] Set up page layout with MainLayout wrapper
  - [ ] Add page title and description
  - [ ] Configure routing
  
- [ ] Task 2: Create ChapterGrid Component (AC: 2, 6, 7)
  - [ ] Create `src/components/Chapters/ChapterGrid.tsx` component
  - [ ] Use MUI Grid component for responsive layout
  - [ ] Configure grid columns (3 desktop, 2 tablet, 1 mobile)
  - [ ] Add proper TypeScript interfaces
  
- [ ] Task 3: Build ChapterCard Component (AC: 2, 7)
  - [ ] Create ChapterCard component using MUI Card
  - [ ] Display chapter number and title
  - [ ] Add chapter thumbnail or icon
  - [ ] Add Free/Premium badge (Chip component)
  - [ ] Style card to match brand guidelines
  
- [ ] Task 4: Add Progress Bar to Cards (AC: 2)
  - [ ] Use MUI LinearProgress component
  - [ ] Calculate progress percentage (completed/total concepts)
  - [ ] Display progress text (e.g., "12/42 completed")
  - [ ] Style progress bar with theme colors
  
- [ ] Task 5: Implement Navigation Logic (AC: 3)
  - [ ] Add onClick handler to chapter cards
  - [ ] Navigate to first concept in chapter on click
  - [ ] Use Next.js router for navigation
  - [ ] Show loading state during navigation
  
- [ ] Task 6: Add Premium Chapter Gating (AC: 4, 5)
  - [ ] Display lock icon on premium chapters for free users
  - [ ] Disable click for premium chapters (free users)
  - [ ] Show upgrade prompt modal on premium chapter click
  - [ ] Allow premium users full access (no lock icon)
  
- [ ] Task 7: Create Upgrade Prompt Modal (AC: 5)
  - [ ] Create upgrade prompt component
  - [ ] Display benefits of premium subscription
  - [ ] Add "Upgrade Now" button linking to payment flow
  - [ ] Add "Learn More" link
  - [ ] Style modal with MUI Dialog
  
- [ ] Task 8: Fetch Chapter Data from API (AC: 2)
  - [ ] Call `GET /api/chapters` endpoint
  - [ ] Handle loading state (skeleton cards)
  - [ ] Handle error state
  - [ ] Map API data to component props
  
- [ ] Task 9: Implement Accessibility Features (AC: 8)
  - [ ] Add ARIA labels for chapter cards
  - [ ] Ensure keyboard navigation works
  - [ ] Add focus indicators
  - [ ] Test with screen readers
  - [ ] Ensure color contrast meets WCAG 2.1 AA
  
- [ ] Task 10: Add Unit Tests
  - [ ] Test grid renders with 8 chapter cards
  - [ ] Test responsive grid layout
  - [ ] Test progress bar displays correctly
  - [ ] Test navigation on chapter card click
  - [ ] Test premium gating for free users
  - [ ] Test lock icon visibility
  - [ ] Test upgrade prompt modal

## Dev Notes

### Previous Story Insights
- Story 1.5.2 (Main Layout) completed: Provides layout wrapper for page [Source: Epic 1.5]
- Story 1.6 (Content Backend) completed: Chapter API endpoint available [Source: Epic 1.5]
- Story 2.4 (Completion Tracking) completed: Progress data available [Source: Epic 1.5]

### Component Location
**Files:**
- Page: `apps/web/src/app/chapters/page.tsx`
- Component: `apps/web/src/components/Chapters/ChapterGrid.tsx`
- Card: `apps/web/src/components/Chapters/ChapterCard.tsx`

### Technology Stack
- **Frontend Framework:** Next.js 15.5.x with App Router
- **UI Component Library:** MUI (Material-UI) ~5.x
- **TypeScript:** ~5.x with strict mode enabled
- **Routing:** Next.js App Router

### MUI Components to Use
- **Grid:** Responsive grid layout
- **Card:** Chapter card container
- **CardMedia:** Chapter thumbnail
- **CardContent:** Card content
- **CardActions:** Action buttons
- **LinearProgress:** Progress bar
- **Chip:** Free/Premium badge
- **Typography:** Text styling
- **IconButton:** Navigate button
- **LockIcon:** Premium chapter indicator
- **Dialog:** Upgrade prompt modal

### API Specifications
[Source: Epic 1.5, Story 1.6 Backend]

**Endpoint:** `GET /api/chapters`

**Response Format:**
```typescript
{
  chapters: [
    {
      id: string;
      chapter_number: number;
      title: string;
      description: string;
      thumbnail_url: string;  // Optional
      is_premium: boolean;
      concept_count: number;
      completed_concept_count: number;
      first_concept_slug: string;
    }
  ]
}
```

### Chapter Data
**8 Chapters:**
1. Foundations of Nursing Practice (Free)
2. Medical-Surgical Nursing (Free)
3. Maternal-Newborn Nursing (Free)
4. Pediatric Nursing (Free)
5. Mental Health Nursing (Premium)
6. Community Health Nursing (Premium)
7. Leadership and Management (Premium)
8. Professional Development (Premium)

### Responsive Grid Configuration
```typescript
<Grid container spacing={3}>
  {chapters.map((chapter) => (
    <Grid 
      item 
      xs={12}      // Mobile: 1 column
      sm={6}       // Tablet: 2 columns
      md={4}       // Desktop: 3 columns
      key={chapter.id}
    >
      <ChapterCard chapter={chapter} />
    </Grid>
  ))}
</Grid>
```

### Progress Bar Calculation
```typescript
const progressPercentage = (chapter.completed_concept_count / chapter.concept_count) * 100;
const progressText = `${chapter.completed_concept_count}/${chapter.concept_count} completed`;

<LinearProgress 
  variant="determinate" 
  value={progressPercentage} 
  sx={{ height: 8, borderRadius: 4 }}
/>
<Typography variant="caption">{progressText}</Typography>
```

### Premium Gating Logic
```typescript
const isPremiumLocked = chapter.is_premium && !user.is_premium;

<Card 
  onClick={() => isPremiumLocked ? showUpgradePrompt() : navigateToChapter(chapter)}
  sx={{ 
    cursor: isPremiumLocked ? 'not-allowed' : 'pointer',
    opacity: isPremiumLocked ? 0.7 : 1 
  }}
>
  {isPremiumLocked && <LockIcon />}
</Card>
```

### Styling Guidelines
[Source: docs/front-end-spec.md, docs/stories/_design-system-reference.md]

**View Design:** [Source: front-end-spec.md, View: All Chapters Grid]

**Page Header:**
- Title: "üìö All NCLEX 311 Chapters & Concepts" (H1, 28px, 600 weight, centered)
- Subtitle: Text secondary (#6c757d), 16px, centered
- Back button: "‚Üê Back to Current Chapter" (blue #2c5aa0, full-width)

**Stats Overview:**
- Grid: 4 columns desktop, 2x2 on mobile
- Background: Light gray (#f8f9fc)
- Padding: 1.5rem (24px)
- Border radius: 8px
- Font: 16px body, 24px numbers (bold)
- Icon color: Primary blue (#2c5aa0)

**Chapter Cards:**
- Background: White
- Border: 2px solid #e1e7f0
- Border radius: 8px
- Padding: 1.5rem (24px)
- Shadow on hover: 0 4px 12px rgba(0,0,0,0.1)
- Transition: 150ms ease-out
- Min height: 280px

**Free Chapter Cards:**
- Badge: "Free" chip (green #00b894, white text)
- Progress bar: Green gradient
- Button: "Continue Learning" (primary blue #2c5aa0)

**Premium Chapter Cards:**
- Badge: "Premium" chip (yellow #ffeaa7, dark text)
- Lock icon: Gray (#6c757d), 20px
- Progress bar: Grayed out/disabled
- Button: "üöÄ Upgrade to Premium" (yellow background #ffeaa7)

**Progress Bars:** [Source: front-end-spec.md]
- Height: 8px
- Border radius: 4px
- Free chapters: Green gradient (#00b894)
- Premium locked: Light gray (#e1e7f0)
- Animation: Animate on load (250ms ease-in-out)

**Typography:**
- Chapter title: 19px (1.2rem), 600 weight, text primary (#2c3e50)
- Page range: 14px, text secondary (#6c757d)
- Progress text: 14px, text secondary

**Responsive Grid:**
- Desktop (‚â•1024px): 3 columns
- Tablet (768-1023px): 2 columns
- Mobile (<768px): 1 column
- Gap: 24px (1.5rem)

**Design Reference Files:** [Source: front-end-spec.md]
- **Mockup:** `scratchpad/sample_chapter_demo_v23.html`
- **Specification:** `docs/front-end-spec.md` (View: All Chapters Grid)
- **Design System:** `docs/stories/_design-system-reference.md`

### Accessibility Requirements
[Source: Epic 1.5, architecture/coding-standards.md]
- **WCAG 2.1 AA Compliance:** Required
- **ARIA Labels:** All cards and interactive elements labeled
- **Keyboard Navigation:** Full keyboard support (Tab, Enter)
- **Focus Indicators:** Visible focus outlines
- **Screen Reader:** Announce chapter info, progress, premium status

### Integration Points
[Source: Epic 1.5]
1. **Story 1.5.2 (Main Layout):** Uses MainLayout wrapper
2. **Story 1.5.1 (Sidebar):** Links to sidebar navigation per chapter
3. **Story 1.6 Backend:** Uses chapters API with freemium logic
4. **Story 2.1 (Payment):** Links upgrade prompt to payment flow
5. **Story 2.4 (Progress):** Displays completion tracking

### TypeScript Interfaces
```typescript
// Chapter Data
interface Chapter {
  id: string;
  chapter_number: number;
  title: string;
  description: string;
  thumbnail_url?: string;
  is_premium: boolean;
  concept_count: number;
  completed_concept_count: number;
  first_concept_slug: string;
}

// Component Props
interface ChapterGridProps {
  chapters: Chapter[];
  userIsPremium: boolean;
}

interface ChapterCardProps {
  chapter: Chapter;
  userIsPremium: boolean;
  onClick: () => void;
}
```

### Testing

**Test File Locations:**
- `apps/web/__tests__/app/chapters/page.test.tsx`
- `apps/web/__tests__/components/Chapters/ChapterGrid.test.tsx`

**Required Test Cases:**
1. **Rendering Tests:**
   - Page renders with 8 chapter cards
   - Grid is responsive (columns change by viewport)
   - Progress bars display correctly
   - Free/Premium badges show correctly

2. **Navigation Tests:**
   - Clicking free chapter navigates to first concept
   - Free users cannot click premium chapters
   - Premium users can click all chapters

3. **Progress Tests:**
   - Progress bar shows correct percentage
   - Progress text shows "X/Y completed"
   - Progress updates reflect completion tracking

4. **Premium Gating Tests:**
   - Lock icon shows on premium chapters (free users)
   - No lock icon for premium users
   - Upgrade prompt shows on premium chapter click (free users)

5. **Accessibility Tests:**
   - ARIA labels present
   - Keyboard navigation works
   - Focus indicators visible
   - Screen reader announcements work

**Testing Pattern Example:**
```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { ChaptersPage } from '@/app/chapters/page';

describe('ChaptersPage', () => {
  const mockChapters = [
    {
      id: 'ch1',
      chapter_number: 1,
      title: 'Foundations of Nursing Practice',
      is_premium: false,
      concept_count: 42,
      completed_concept_count: 12,
      first_concept_slug: 'intro-to-nursing',
    },
    {
      id: 'ch5',
      chapter_number: 5,
      title: 'Mental Health Nursing',
      is_premium: true,
      concept_count: 38,
      completed_concept_count: 0,
      first_concept_slug: 'mental-health-intro',
    },
  ];
  
  it('renders all 8 chapters in grid', () => {
    render(<ChaptersPage />);
    
    const cards = screen.getAllByRole('article'); // Chapter cards
    expect(cards).toHaveLength(8);
  });
  
  it('shows lock icon on premium chapters for free users', () => {
    render(<ChaptersPage />);
    
    const lockIcons = screen.getAllByTestId('LockIcon');
    expect(lockIcons).toHaveLength(4); // Chapters 5-8
  });
  
  it('navigates to first concept on chapter click', () => {
    const mockRouter = { push: jest.fn() };
    render(<ChaptersPage />);
    
    const chapter1Card = screen.getByText('Foundations of Nursing Practice');
    fireEvent.click(chapter1Card);
    
    expect(mockRouter.push).toHaveBeenCalledWith('/concepts/intro-to-nursing');
  });
  
  it('shows upgrade prompt when free user clicks premium chapter', () => {
    render(<ChaptersPage />);
    
    const premiumChapterCard = screen.getByText('Mental Health Nursing');
    fireEvent.click(premiumChapterCard);
    
    expect(screen.getByText(/Upgrade to Premium/i)).toBeInTheDocument();
  });
});
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-02 | 1.0 | Initial story creation for Epic 1.5 | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

### Agent Model Used
*Will be recorded by dev agent*

### Debug Log References
*Will be populated by the development agent*

### Completion Notes List
*Will be populated by the development agent*

### File List
*Will be populated by the development agent*

## QA Results
*This section will be populated by QA Agent after implementation*
