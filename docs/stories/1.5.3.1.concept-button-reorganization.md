# Story 1.5.3.1: Concept Page Button Reorganization

## Status
**To Do** (P0 - Critical)

## Story
**As a** user,  
**I want** action buttons at the natural completion points of my learning flow,  
**so that** I'm prompted to take actions (bookmark, complete, discuss) AFTER reading content, not before.

**Note:** This story corrects Story 1.5.3 button placement to match approved mockup design.

## Acceptance Criteria
1. Remove all 4 buttons from top of ConceptViewer (currently below "📖 READ THIS" header)
2. Add star bookmark icon (⭐) to upper right corner of concept content area:
   - Positioned absolute/floating in top-right
   - Toggles bookmark status (filled when bookmarked, outline when not)
   - 44px minimum tap target
3. Add 3 action buttons at bottom of concept content:
   - Positioned after reference section and connection cards
   - Horizontally aligned: [💬 Discussion] [✅ Mark Complete] [📝 Take Notes]
   - Only shown after user scrolls past quiz section
4. Add fixed footer to sidebar with 3 action buttons:
   - Positioned at bottom of sidebar (below concept list, above quick-access buttons)
   - Vertically stacked: [💬 Discussion] [✅ Mark Complete] [📝 Take Notes]
   - Fixed position so buttons remain visible while scrolling
5. Synchronize button state between sidebar footer and bottom buttons:
   - Clicking either location updates bookmark/complete status
   - Visual state (e.g., "Completed" green fill) syncs across both locations
6. Button styling matches mockup:
   - Discussion: Blue outline (#2c5aa0)
   - Mark Complete: Green fill when completed (#00b894), outline when not
   - Take Notes: Blue outline (#2c5aa0)
   - All buttons: 44px minimum height (touch-friendly)
7. Star bookmark icon styling:
   - Filled star (★): Orange (#ff6b35) when bookmarked
   - Outline star (☆): Gray (#6c757d) when not bookmarked
   - Smooth transition between states (300ms)
8. Bottom buttons only appear after quiz section (not immediately visible)
9. Mobile: Sidebar footer buttons work in mobile drawer mode

## Tasks / Subtasks

- [ ] Task 1: Remove Top Buttons from ConceptViewer (AC: 1)
  - [ ] Edit `apps/web/src/components/Concept/ConceptViewer.tsx`
  - [ ] Delete button group at lines ~322-415
  - [ ] Remove related state management for top buttons
  - [ ] Clean up imports if no longer needed
  
- [ ] Task 2: Add Star Bookmark Icon (AC: 2, 7)
  - [ ] Create BookmarkStar component or add to ConceptViewer
  - [ ] Position absolute in upper right corner of content area
  - [ ] Implement filled/outline star toggle
  - [ ] Wire up bookmark API call (POST/DELETE /api/me/bookmarks)
  - [ ] Add 44px tap target with proper padding
  - [ ] Style with orange fill (#ff6b35) and gray outline (#6c757d)
  - [ ] Add 300ms transition animation
  
- [ ] Task 3: Create Bottom Action Buttons Component (AC: 3, 6, 8)
  - [ ] Create ConceptActions component
  - [ ] Add 3 buttons: Discussion, Mark Complete, Take Notes
  - [ ] Position after reference/connection sections
  - [ ] Implement horizontal layout
  - [ ] Apply button styling per design system
  - [ ] Wire up API calls and modal triggers
  - [ ] Add conditional rendering (only after quiz section)
  
- [ ] Task 4: Add Sidebar Footer with Action Buttons (AC: 4, 6, 9)
  - [ ] Edit ConceptList component
  - [ ] Add fixed footer section (above quick-access buttons)
  - [ ] Add 3 buttons: Discussion, Mark Complete, Take Notes
  - [ ] Implement vertical stack layout
  - [ ] Apply button styling per design system
  - [ ] Position fixed at bottom of sidebar
  - [ ] Ensure buttons remain visible during scroll
  
- [ ] Task 5: Synchronize Button State (AC: 5)
  - [ ] Create shared state management (Context or Zustand)
  - [ ] Connect bookmark star, bottom buttons, and sidebar buttons
  - [ ] Ensure all locations update when any is clicked
  - [ ] Sync "Mark Complete" visual state (green fill)
  - [ ] Test state synchronization across all button locations
  
- [ ] Task 6: Style Bottom Buttons (AC: 6)
  - [ ] Discussion button: Blue outline (#2c5aa0)
  - [ ] Mark Complete: Green fill when completed (#00b894)
  - [ ] Take Notes: Blue outline (#2c5aa0)
  - [ ] All buttons: 44px minimum height
  - [ ] Proper spacing between buttons (16px)
  
- [ ] Task 7: Integration Testing (AC: 3, 4, 5, 8, 9)
  - [ ] Test top buttons removed
  - [ ] Test star bookmark toggle functionality
  - [ ] Test bottom buttons appear after quiz
  - [ ] Test sidebar footer buttons visible and functional
  - [ ] Test state synchronization across all locations
  - [ ] Test mobile drawer footer buttons
  
- [ ] Task 8: Visual QA Against Mockup
  - [ ] Compare to sample_chapter_demo_v23.html
  - [ ] Verify button positions match mockup
  - [ ] Verify button styling matches mockup
  - [ ] Verify star icon position and styling
  - [ ] Verify sidebar footer layout

## Technical Notes

**Files to Modify:**
- `apps/web/src/components/Concept/ConceptViewer.tsx` - Remove top buttons, add star icon
- `apps/web/src/components/Concept/ConceptActions.tsx` - NEW (bottom buttons)
- `apps/web/src/components/Sidebar/ConceptList.tsx` - Add fixed footer with buttons

**Sidebar Footer Structure:**
```
┌─────────────────────────────┐
│ [Concept List - scrollable] │
│                             │
├─────────────────────────────┤ ← Action Buttons (fixed)
│ [💬 Discussion]             │
│ [✅ Mark Complete]          │
│ [📝 Take Notes]             │
├─────────────────────────────┤ ← Quick Access Buttons
│ [📚 All Chapters]           │
│ [📊 Progress]               │
│ [🔖 Bookmarks]              │
└─────────────────────────────┘
```

**State Management:**
- Option A: React Context for button state
- Option B: Zustand store for concept interaction state
- Recommendation: Context (simpler for this use case)

**API Endpoints:**
- `POST /api/me/bookmarks` - Add bookmark
- `DELETE /api/me/bookmarks` - Remove bookmark
- `POST /api/me/completed-concepts` - Mark complete
- `DELETE /api/me/completed-concepts` - Un-mark complete

**Design References:**
- Mockup: `scratchpad/sample_chapter_demo_v23.html`
- Spec: `docs/front-end-spec.md` (Concept Viewer section)
- Report: `docs/UI-UX-DISCREPANCY-REPORT.md` (Section 2)

## Estimated Effort
**2-3 hours**

## Priority
**P0 - Critical** (Blocks natural learning flow UX)

## Dependencies
- Story 1.5.3 (ConceptViewer component)
- Story 1.5.1.1 (Sidebar with footer section)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Created as corrective story for Epic 1.5 | Sarah (PO) |
